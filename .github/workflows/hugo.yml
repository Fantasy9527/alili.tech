name: Build and Deploy

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Node.js
      uses: actions/setup-node@v1
      with:
        node-version: '10.13.0'

    - name: Install Hugo
      run: |
        wget https://github.com/gohugoio/hugo/releases/download/v0.51/hugo_0.51_Linux-64bit.deb
        sudo dpkg -i hugo*.deb
        hugo version

    - name: Install dependencies and build
      run: |
        rm -rf public
        npm install
        # cp -r ./backup/Reprint/* ./content/archive/
        npm run build
        echo 'Build done!'

    - name: Deploy to GitHub Pages
      run: |
        git config --global user.email "incomparable9527@foxmail.com"
        git config --global user.name "Fan"
        git clone https://${ACCESS_TOKEN}@github.com/Fantasy9527/alili.tech.git container
        rm -rf container/*
        cp -r public/* container 
        cd container
        git add .
        git commit -m 'Travis upate blog'
        git push -u origin gh-pages -f

    - name: Additional Deployment Steps
      run: |
        git remote add coding ${CODING_REPO}
        git checkout --orphan latest_branch
        git add -A
        git commit -am "clear"
        git branch -D gh-pages
        git branch -m gh-pages
        git push -u coding gh-pages:master -f
